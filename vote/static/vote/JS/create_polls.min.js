function createPoll(e){if(e.preventDefault(),!checkInputs(e))return;comp_form.classList.remove("was-validated");const t=input_1.value.trim(),o=input_2.value.trim(),r="\n    mutation CreatePoll($comp1: String!, $comp2: String!) {\n      createPoll(comp1: $comp1, comp2: $comp2) {\n        poll {\n          id\n          comp1 {\n            id \n            name\n          }\n          comp2 {\n            id\n            name\n          }\n        }\n      }\n    }\n  ";fetch("/graphql/#",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRFToken":getCookie("csrftoken")},body:JSON.stringify({query:r,variables:{comp1:t,comp2:o}}),credentials:"include"}).then(e=>{if(!e.ok)throw Error(`${e.statusText} - ${e.status}`);return e.json()}).then(e=>{if(e.errors)throw Error(e.errors[0].message);const t=new Competitor(e.data.createPoll.poll.comp1.id,e.data.createPoll.poll.comp1.name),o=new Competitor(e.data.createPoll.poll.comp2.id,e.data.createPoll.poll.comp2.name);localStorage.setItem("comp_1",t.serialize()),localStorage.setItem("comp_2",o.serialize()),localStorage.setItem("poll",e.data.createPoll.poll.id.toString()),localStorage.removeItem("winner"),document.getElementById("choose-comps").classList.add("d-none"),document.getElementById("poll-container").classList.remove("d-none"),document.getElementById("comp-1").innerHTML=t.name,document.getElementById("comp-2").innerHTML=o.name,addInputs(9,null,!0),history.pushState({new_mode:"easy"},"Easy Mode","#easy"),prepareNavbar("easy"),document.getElementById("mode").dataset.current_mode="easy",document.getElementById("mode").innerHTML="Easy Mode";const r=document.getElementById("previous");r.disabled=!0,r.classList.add("disabled"),createAlert("Recuerda que los últimos 3 cuadritos siempre son para Skills, Flow y Puesta en escena"),setCookie("isActive","true",.5);const n=document.createElement("script");n.src="/static/vote/JS/add_listeners.min.js",n.type="module";const a=document.createElement("script");a.src="/static/vote/JS/change_mode.min.js",a.type="module";const c=document.createElement("script");c.src="/static/vote/JS/validation.min.js",c.type="module",appendChilds("body",n,a,c)}).catch(e=>{createError(e)})}function checkInput(e,t){e.preventDefault(),e.stopPropagation();const o=t.value.trim();return""===o?setErrorFor(t,"Por favor, llene el campo para continuar"):o.length<2||o.length>20?setErrorFor(t,"El competidor tiene que tener entre 2 y 20 caracteres"):"replica"===o||"Réplica"===o?setErrorFor(t,"El competidor no se puede llamar 'replica'"):setSuccessFor(t)}function checkInputs(e){e.preventDefault(),e.stopPropagation();const t=[input_1.value.trim(),input_2.value.trim()],o=[input_1,input_2];let r=0;return t.forEach((e,t)=>""===e?setErrorFor(o[t],"Por favor, llene el campo para continuar"):e.length<2||e.length>20?setErrorFor(o[t],"El competidor tiene que tener entre 2 y 20 caracteres"):"replica"===e||"Réplica"===e?setErrorFor(o[t],"El competidor no se puede llamar 'replica'"):(setSuccessFor(o[t]),void r++)),2===r}function setErrorFor(e,t){const o=e.parentElement,r=o.querySelector("div");return r.innerText=t,o.parentElement.parentElement.classList.add("was-validated"),e.classList.add("is-invalid"),e.classList.remove("is-valid"),e.setCustomValidity(t),!1}function setSuccessFor(e){return e.classList.remove("is-invalid"),e.classList.add("is-valid"),e.setCustomValidity(""),!0}import{addInputs,createAlert,createError,getCookie,setCookie}from"./util.js";import{Competitor}from"./classes.js";import{prepareNavbar}from"./navbar.js";const comp_form=document.getElementById("comps-form"),input_1=document.getElementById("comp-1-input"),input_2=document.getElementById("comp-2-input");[input_1,input_2].forEach(e=>{e.addEventListener("input",t=>{checkInput(t,e)})}),comp_form.addEventListener("submit",e=>createPoll(e));export function appendChilds(e,...t){const o=document.querySelector(e);for(let e of t)o.appendChild(e)}