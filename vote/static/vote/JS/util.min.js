function insertAfter(e,t){t.parentNode.insertBefore(e,t.nextSibling)}function saveWinner(e){const t="\n    mutation SaveWinner($id: ID!, $winner: String!) {\n      saveWinner(pollId: $id, winner: $winner) {\n        poll {\n          winner\n        }\n      }\n    }\n  ";fetch("/graphql/",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRFToken":getCookie("csrftoken")},body:JSON.stringify({query:t,variables:{id:parseInt(localStorage.getItem("poll")),winner:e}}),credentials:"include"}).then(e=>{if(!e.ok)throw Error(`${e.statusText} - ${e.status}`);return e.json()}).then(e=>{if(e.errors)throw Error(e.errors[0].message)}).catch(e=>{createError(e)})}import{modes_to_int}from"./classes.js";import{validateModeInputs}from"./validation.js";export function getCookie(e){let t=null;if(document.cookie&&""!==document.cookie){const n=document.cookie.split(";");for(let o=0;o<n.length;o++){const r=n[o].trim();if(r.substring(0,e.length+1)===e+"="){t=decodeURIComponent(r.substring(e.length+1));break}}}return t}export function useModal(e,t){document.getElementById("modal-title").innerHTML=e,document.getElementById("modal-body").innerHTML=t;const n=new bootstrap.Modal(document.getElementById("modal"));n.toggle(),document.getElementById("modal").addEventListener("hidden.bs.modal",()=>{document.getElementById("modal-title").innerHTML="",document.getElementById("modal-body").innerHTML=""})}export function addInputs(e,t,n=!1){n||Array.from(document.getElementsByClassName("inputs-container")).forEach(e=>{const t=e.firstElementChild;e.innerHTML="",e.append(t)});const o=document.getElementById("mode").dataset.current_mode,r=document.getElementById("comp-1").parentElement.parentElement,a=document.getElementById("comp-2").parentElement.parentElement;if(!n){const e=document.querySelector(".poll"),t=e.querySelector("hr");modes_to_int[o]%2==0||"replica"===o?(e.insertBefore(r,a),e.insertBefore(t,a)):(e.insertBefore(a,r),e.insertBefore(t,r))}Array.from(document.getElementsByClassName("comp-container")).forEach((n,r)=>{for(let a=0;a<e;a++){const i=document.createElement("div");i.classList.add("input"),e%3==0||a!==e-5&&a!==e-4||(2===Math.round(e%3)?a===e-5?i.classList.add("input-left"):i.classList.add("input-right"):1===Math.round(e%3)&&a===e-4&&i.classList.add("input-middle")),a>e-4&&(a===e-3?i.classList.add("input-extra-left"):a===e-1&&i.classList.add("input-extra-right"));const s=document.createElement("input");if(s.type="number","comp-1-container"===n.id?s.classList.add("form-control","comp-1-input"):s.classList.add("form-control","comp-2-input"),s.required=!0,s.min="0",s.max="4",s.step="0.5",s.maxLength=3,s.inputMode="decimal","random_score"!==o&&"deluxe"!==o&&"replica"!==o||(s.tabIndex=tabindex[o][r][a]),i.append(s),o.startsWith("min")&&1===r&&a<e-3){const e=document.createElement("input");e.type="checkbox","comp-1-container"===n.id?e.classList.add("form-check-input","check-1"):e.classList.add("form-check-input","check-2"),i.append(e)}t&&(o.startsWith("min")&&1===r&&a<e-3&&(s.nextElementSibling.checked=1===t.data.comp2.mode[a+9]),"comp-1-container"===n.id?0!==t.data.comp1.mode.length&&9!==t.data.comp1.mode[a]&&(s.value=t.data.comp1.mode[a].toString()):0!==t.data.comp2.mode.length&&9!==t.data.comp2.mode[a]&&(s.value=t.data.comp2.mode[a].toString())),insertAfter(i,0===a?n:document.getElementsByClassName("input")[document.getElementsByClassName("input").length-1])}}),validateModeInputs(),n||modes_to_int[o]%2==0?r.getElementsByTagName("div")[1].firstElementChild.focus():a.getElementsByTagName("div")[1].firstElementChild.focus()}const tabindex={random_score:[[1,2,5,6,9,10,13,14,17,18,19],[3,4,7,8,11,12,15,16,20,21,22]],deluxe:[[1,3,5,7,9,11,13,15,17,19,21,23,24,25],[2,4,6,8,10,12,14,16,18,20,22,26,27,28]],replica:[[2,4,6,8,10,12,16,17,18],[1,3,5,7,9,11,13,14,15]]};export function createAlert(e){const t=`\n  <div class="alert alert-info alert-dismissible fade show mb-5" role="alert">\n    ${e}\n    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>\n  </div>\n  `;document.getElementById("alert-container").innerHTML=t}export function getKeyByValue(e,t){return Object.keys(e).find(n=>e[n]===t)}export function createError(e){"TypeError: Failed to fetch"===e.stack&&(e.message="Hubo un error en el proceso, intenta más tarde."),useModal("Error",e.message)}export function arraysMatch(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}export function getWinner(e,t,n=!1){if(n){const n=e.get_sum("replica"),o=t.get_sum("replica");if(1===e.counter){if(n===o||Math.abs(n-o)<1)return"decide";const r=Math.max(n,o),a=r===n?e.name:t.name;return saveWinner(a),a}if(n===o||Math.abs(n-o)<=1)return"Réplica";const r=Math.max(n,o),a=r===e.get_sum("replica")?e.name:t.name;return saveWinner(a),a}const o=e.get_total(),r=t.get_total();if(o===r||Math.abs(o-r)<5.5)return"Réplica";const a=Math.max(o,r),i=a===e.get_total()?e.name:t.name;return saveWinner(i),i}export function setCookie(e,t,n){var o=new Date;o.setTime(o.getTime()+24*n*60*60*1e3);var r="expires="+o.toUTCString();document.cookie=`${e}=${t};${r};path=/`}export function reload(){location.assign(location.href.split("/").slice(0,3).join("/"))}